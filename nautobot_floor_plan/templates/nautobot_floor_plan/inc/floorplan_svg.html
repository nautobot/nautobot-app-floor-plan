{% load buttons %}
{% load static %}

{% if object %}
    <div class="pull-right noprint">
        <a class="btn btn-warning btn-md" href="{% url 'plugins:nautobot_floor_plan:floorplan_edit' object.pk %}" class="btn btn-warning btn-sd" id="edit-button">
            <span aria-hidden="true" class="mdi mdi-checkerboard" aria-hidden="true"></span> Edit Floorplan
        </a>
        <a class="btn btn-primary btn-md" href="{% url 'plugins:nautobot_floor_plan:floorplantile_add' %}?floor_plan={{ object.pk }}" class="btn btn-primary btn-sm" id="add-floor-plan">
            <span aria-hidden="true" class="mdi mdi-plus-box" aria-hidden="true"></span> Add Tile
        </a>
    </div>
    <h4>{{ object }}</h4>
    <div>
        <button class="btn btn-success btn-md" id="toggle-zoom-mode">Enable Box Zoom</button>
        <button class="btn btn-danger btn-md" id="reset-zoom">Reset View</button>
    </div>

    <div class="text-center">
        <a class="rack_elevation_save_svg_link" download="floor_plan_{{ object.location.name }}.svg" href="{% url 'plugins-api:nautobot_floor_plan-api:floorplan-svg' pk=object.pk %}">
            <span class="mdi mdi-content-save-outline"></span> Save SVG
        </a>
    </div>

    {% comment %}
    Add Tippy.js resources - using local files for air-gapped environments
    Add Gsap.js resources - using local files for air-gapped environments
    {% endcomment %}
    <link href="{% static 'nautobot_floor_plan/css/light.css' %}" rel="stylesheet"/>
    <link href="{% static 'nautobot_floor_plan/css/multiselect.css' %}" rel="stylesheet"/>

<script src="{% static 'nautobot_floor_plan/tippy.js-6.3.7/popper.min.js' %}"></script>
<script src="{% static 'nautobot_floor_plan/tippy.js-6.3.7/tippy-bundle.umd.min.js' %}"></script>
<script src="{% static 'nautobot_floor_plan/gsap.js-3.12.2/gsap.min.js' %}"></script>
<script src="{% static 'nautobot_floor_plan/js/floorplan-tooltips.js' %}?v={% now 'U' %}"></script>
<script src="{% static 'nautobot_floor_plan/js/floorplan-multiselect.js' %}?v={% now 'U' %}"></script>
<script src="{% static 'nautobot_floor_plan/js/floorplan.js' %}?v={% now 'U' %}"></script>
    <script>
        // Set animation duration constants for floorplan.js
        window.ZOOM_DURATION = {{ zoom_duration|default:"0.5" }};
        window.HIGHLIGHT_DURATION = {{ highlight_duration|default:"2" }};

        // Set user permissions for bulk edit operations
        window.FLOOR_PLAN_PERMISSIONS = {
            canEditRacks: {% if perms.dcim.change_rack %}true{% else %}false{% endif %},
            canEditDevices: {% if perms.dcim.change_device %}true{% else %}false{% endif %},
            canEditPowerPanels: {% if perms.dcim.change_powerpanel %}true{% else %}false{% endif %},
            canEditPowerFeeds: {% if perms.dcim.change_powerfeed %}true{% else %}false{% endif %}
        };

        // Initialize tooltips after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeFloorPlanTooltips);
        } else {
            initializeFloorPlanTooltips();
        }
    </script>

    {% comment %}
    Scale the SVG by default to match the page width, preserving its aspect-ratio.
    See https://css-tricks.com/scale-svg/ for more details.
    {% endcomment %}
    <div id="floor-plan-svg-container" style="position: relative; height: 0; width: 100%; padding: 0; padding-bottom: calc(100% * ({{ object.y_size }} * {{ object.tile_depth }}) / ({{ object.x_size }} * {{ object.tile_width }}) / 1.2);">
        <a id="zoom-anchor"></a>
        <div data-floor-plan-x-size="{{ object.x_size }}" data-floor-plan-y-size="{{ object.y_size }}" data-svg-url="{% url 'plugins-api:nautobot_floor_plan-api:floorplan-svg' pk=object.pk %}" id="floor-plan-svg" style="position: absolute; height: 100%; width: 100%; left: 0; top: 0;">
        </div>
    </div>
{% else %}
    {% comment %}
    The UI should normally not even show the option to reach this view, but someone could enter it manually.
    {% endcomment %}
    No floor plan defined. Use the "Add Floor Plan" button above to create one if desired.
{% endif %}
